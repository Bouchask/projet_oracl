<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Smart University</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/style.css">
</head>
<body>

    <div id="updateModal" class="modal" style="z-index: 1000;">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3 id="modalTitle" class="text-xl font-bold mb-4 text-gray-800">Modification</h3>
            <div id="modalBody"></div>
            <div class="text-right mt-6">
                <button class="btn-primary px-6 py-2 rounded-lg" onclick="submitUpdate()">Enregistrer</button>
            </div>
        </div>
    </div>

    <div id="detailsModal" class="modal" style="z-index: 1100;">
        <div class="modal-content" style="max-width: 800px; width: 90%;">
            <span class="close-btn" onclick="closeDetailsModal()">&times;</span>
            
            <div class="border-b border-gray-200 pb-4 mb-4 flex justify-between items-start">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800" id="detail_name">Chargement...</h2>
                    <p class="text-gray-500 font-mono" id="detail_code">...</p>
                    <p class="text-sm text-gray-400" id="detail_email">...</p>
                </div>
                <div class="text-right">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800" id="detail_filiere">
                        ...
                    </span>
                </div>
            </div>

            <h3 class="text-lg font-bold text-gray-700 mb-3">Historique Acad√©mique</h3>
            <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Semestre</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Cours</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Professeur</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Note</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Statut</th>
                        </tr>
                    </thead>
                    <tbody id="transcriptBody" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
            
            <div class="mt-6 text-right">
                <button class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition" onclick="closeDetailsModal()">Fermer</button>
            </div>
        </div>
    </div>

    <div id="teacherDetailsModal" class="modal" style="z-index: 1100;">
        <div class="modal-content" style="max-width: 900px; width: 95%;">
            <span class="close-btn" onclick="closeTeacherModal()">&times;</span>
            
            <div class="flex justify-between items-start border-b pb-4 mb-4">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800" id="tch_detail_name">...</h2>
                    <p class="text-gray-500" id="tch_detail_email">...</p>
                </div>
                <div class="text-right">
                    <span class="badge badge-primary text-lg" id="tch_detail_dept">...</span>
                </div>
            </div>

            <div class="flex justify-between items-center mb-3">
                <h3 class="text-lg font-bold text-gray-700">Sections & Cours Enseign√©s</h3>
                <input type="text" id="tch_search" placeholder="Filtrer (ex: S3, Java...)" 
                       class="border rounded px-3 py-1 text-sm w-64 focus:ring-2 focus:ring-orange-500 outline-none"
                       onkeyup="filterTeacherTable()">
            </div>

            <div class="table-container" style="max-height: 300px; overflow-y: auto;">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Cours</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Fili√®re/Sem</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Salle/Horaire</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Occupation</th>
                            <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase">Listes √âtudiants</th>
                        </tr>
                    </thead>
                    <tbody id="teacherSectionsBody" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>

            <div id="studentListZone" class="hidden mt-4 pt-4 border-t border-gray-200 bg-gray-50 p-4 rounded-lg animate-fade-in">
                <div class="flex justify-between items-center mb-2">
                    <h4 class="font-bold text-gray-800" id="studentListTitle">Liste</h4>
                    <button onclick="document.getElementById('studentListZone').classList.add('hidden')" class="text-gray-500 hover:text-red-500 font-bold">‚úï</button>
                </div>
                <div class="max-h-40 overflow-y-auto">
                    <table class="w-full text-sm">
                        <thead class="text-xs text-gray-500 bg-gray-100 uppercase">
                            <tr>
                                <th class="py-2 text-left">Code</th>
                                <th class="py-2 text-left">Nom</th>
                                <th class="py-2 text-left">Date</th>
                            </tr>
                        </thead>
                        <tbody id="studentListBody"></tbody>
                    </table>
                </div>
            </div>
            
            <div class="mt-6 text-right">
                <button class="btn-secondary" onclick="closeTeacherModal()">Fermer</button>
            </div>
        </div>
    </div>

    <div id="changeDeptModal" class="modal" style="z-index: 1200;">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-btn" onclick="document.getElementById('changeDeptModal').style.display='none'">&times;</span>
            
            <h3 class="text-xl font-bold text-gray-800 mb-4">Affectation D√©partement</h3>
            
            <div class="mb-4">
                <p class="text-sm text-gray-500">Professeur</p>
                <p class="text-lg font-bold text-gray-800" id="chg_dept_prof_name">...</p>
            </div>

            <div class="mb-6 bg-blue-50 p-4 rounded-lg border border-blue-100">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-semibold text-blue-800">Actuel :</span>
                    <span class="badge badge-primary" id="chg_dept_current">...</span>
                </div>
                
                <label class="block text-sm font-semibold text-gray-700 mt-4 mb-2">Nouveau D√©partement :</label>
                <select id="chg_dept_select" class="w-full border-2 border-gray-300 rounded-lg p-2 bg-white outline-none focus:border-blue-500 transition">
                    </select>
            </div>

            <div class="text-right">
                <button onclick="submitDeptChange()" class="btn-primary w-full justify-center">Enregistrer le changement</button>
            </div>
        </div>
    </div>

    <div id="courseDetailsModal" class="modal" style="z-index: 1100;">
        <div class="modal-content" style="max-width: 800px; width: 95%;">
            <span class="close-btn" onclick="closeCourseModal()">&times;</span>
            
            <div class="border-b border-gray-200 pb-4 mb-4">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800" id="crs_detail_title">...</h2>
                        <div class="flex gap-2 mt-1">
                            <span class="badge badge-primary" id="crs_detail_fil">...</span>
                            <span class="badge badge-info" id="crs_detail_sem">...</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="text-3xl font-bold text-gray-700" id="crs_detail_credits">0</span>
                        <span class="text-sm text-gray-500 block">Cr√©dits</span>
                    </div>
                </div>

                <div class="mt-6">
                    <div class="flex justify-between text-sm mb-1 font-medium">
                        <span>Heures Planifi√©es</span>
                        <span id="crs_hours_text">0 / 0h</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div id="crs_hours_bar" class="bg-green-500 h-4 rounded-full transition-all duration-1000" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <h3 class="text-lg font-bold text-gray-700 mb-3">Sections Programm√©es</h3>
            <div class="table-container" style="max-height: 300px; overflow-y: auto;">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Professeur</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Jour & Heure</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Salle</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Dur√©e</th>
                            <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase">Capacit√©</th>
                        </tr>
                    </thead>
                    <tbody id="courseSectionsBody" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
            
            <div class="mt-6 text-right">
                <button class="btn-secondary" onclick="closeCourseModal()">Fermer</button>
            </div>
        </div>
    </div>

    <div id="filiereDetailsModal" class="modal" style="z-index: 1100;">
        <div class="modal-content" style="max-width: 700px; width: 95%;">
            <span class="close-btn" onclick="closeFiliereModal()">&times;</span>
            
            <div class="border-b border-gray-200 pb-4 mb-4 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800" id="fil_detail_name">...</h2>
                    <p class="text-gray-500" id="fil_detail_dept">... Department</p>
                </div>
                <div class="text-right">
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Semestre</label>
                    <select id="fil_det_sem_select" onchange="refreshFiliereCourses()" 
                            class="border-2 border-orange-500 rounded-lg px-3 py-1 bg-white font-bold text-gray-700 outline-none focus:ring-2 focus:ring-orange-200">
                        </select>
                </div>
            </div>

            <h3 class="text-lg font-bold text-gray-700 mb-3">Programme P√©dagogique</h3>
            <div class="table-container" style="max-height: 350px; overflow-y: auto;">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Cours</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Cr√©dits</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase">Volume Horaire</th>
                            <th class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase">Sections Actives</th>
                        </tr>
                    </thead>
                    <tbody id="filiereCoursesBody" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
            
            <div class="mt-6 text-right">
                <button class="btn-secondary" onclick="closeFiliereModal()">Fermer</button>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <h2 class="text-2xl font-bold text-white mb-8 px-2 flex items-center gap-2">
            üéì Admin Panel
        </h2>
        <button onclick="showSection('students')" class="active"><span>üë®‚Äçüéì</span> √âtudiants</button>
        <button onclick="showSection('teachers')"><span>üë®‚Äçüè´</span> Professeurs</button>
        <button onclick="showSection('courses')"><span>üìö</span> Cours</button>
        <button onclick="showSection('filieres')"><span>üéì</span> Fili√®res</button>
        <button onclick="showSection('departments')"><span>üè¢</span> D√©partements</button>
        <button onclick="showSection('semesters')"><span>‚è≥</span> Semestres</button>
        <button onclick="showSection('salles')"><span>üö™</span> Salles</button>
        <button onclick="showSection('sections')"><span>üìÖ</span> Sections</button> 
        <button onclick="showSection('audit')"><span>üëÅÔ∏è</span> Audit Logs</button>
        
        <div class="mt-auto pt-4 border-t border-gray-700">
            <button onclick="logout()" class="logout-btn w-full text-left px-6 py-3 hover:bg-red-600 transition flex items-center gap-3 text-red-100">
                <span>üö™</span> D√©connexion
            </button>
        </div>
    </div>

    <div class="main-content">
        <div id="notification"></div>

        <div class="stats-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="stat-card"><span class="stat-number" id="stat-students">0</span><span class="stat-label">√âtudiants</span></div>
            <div class="stat-card"><span class="stat-number" id="stat-teachers">0</span><span class="stat-label">Professeurs</span></div>
            <div class="stat-card"><span class="stat-number" id="stat-courses">0</span><span class="stat-label">Cours</span></div>
            <div class="stat-card"><span class="stat-number" id="stat-sections">0</span><span class="stat-label">Sections</span></div>
        </div>

        <div id="students" class="section-view active">
            <div class="header mb-6"><h1>Gestion des √âtudiants</h1></div>
            
            <div id="students-form" class="card" style="display:none;">
                <h3 class="text-lg font-bold mb-4">Ajouter un √âtudiant</h3>
                <div class="form-grid grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group"><label>Pr√©nom</label><input type="text" id="std_fname" class="input-field"></div>
                    <div class="form-group"><label>Nom</label><input type="text" id="std_lname" class="input-field"></div>
                    <div class="form-group"><label>Email</label><input type="email" id="std_email" class="input-field"></div>
                    <div class="form-group"><label>Fili√®re</label><select id="std_filiere" class="input-field"></select></div>
                    <div class="form-group"><label>Semestre</label><select id="std_semestre" class="input-field"></select></div>
                    <div class="form-group"><label>Mot de passe</label><input type="password" id="std_pass" class="input-field"></div>
                </div>
                <button class="btn-primary mt-4" onclick="addStudent()">Ajouter</button>
            </div>

            <div id="students-list" class="list-container"></div>
        </div>

        <div id="teachers" class="section-view">
            <div class="header mb-6"><h1>Gestion des Professeurs</h1></div>
            
            <div id="teachers-form" class="card" style="display:none;">
                <h3 class="text-lg font-bold mb-4">Ajouter un Professeur</h3>
                <div class="form-grid grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group"><label>Nom Complet</label><input type="text" id="prof_name" class="input-field"></div>
                    <div class="form-group"><label>Email</label><input type="email" id="prof_email" class="input-field"></div>
                    <div class="form-group"><label>D√©partement</label><select id="prof_dept" class="input-field"></select></div>
                    <div class="form-group"><label>Mot de passe</label><input type="password" id="prof_pass" class="input-field"></div>
                </div>
                <button class="btn-primary mt-4" onclick="addTeacher()">Ajouter</button>
            </div>
            
            <div id="teachers-list" class="list-container"></div>
        </div>

        <div id="courses" class="section-view">
            <div class="header mb-6"><h1>Gestion des Cours</h1></div>
            
            <div id="courses-form" class="card" style="display:none;">
                <h3 class="text-lg font-bold mb-4">Ajouter un Cours</h3>
                <div class="form-grid grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group"><label>Titre</label><input type="text" id="course_title" class="input-field"></div>
                    <div class="form-group"><label>Cr√©dits</label><input type="number" id="course_credits" class="input-field"></div>
                    <div class="form-group"><label>Heures</label><input type="number" id="course_hours" value="40" class="input-field"></div>
                    <div class="form-group"><label>Fili√®re</label><select id="course_filiere" class="input-field"></select></div>
                    <div class="form-group"><label>Semestre</label><select id="course_semestre" class="input-field"></select></div>
                </div>
                <button class="btn-primary mt-4" onclick="addCourse()">Ajouter</button>
            </div>
            
            <div id="courses-list" class="list-container"></div>
        </div>

        <div id="filieres" class="section-view">
            <div class="header mb-6"><h1>Gestion des Fili√®res</h1></div>
            <div id="filieres-form" class="card" style="display:none;">
                <h3 class="text-lg font-bold mb-4">Ajouter une Fili√®re</h3>
                <div class="form-grid grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group"><label>Nom</label><input type="text" id="fil_name" class="input-field"></div>
                    <div class="form-group"><label>D√©partement</label><select id="fil_dept" class="input-field"></select></div>
                </div>
                <button class="btn-primary mt-4" onclick="addFiliere()">Ajouter</button>
            </div>
            <div id="filieres-list" class="list-container"></div>
        </div>

        <div id="departments" class="section-view">
            <div class="header mb-6"><h1>Gestion des D√©partements</h1></div>
            <div id="departments-form" class="card" style="display:none;">
                <h3 class="text-lg font-bold mb-4">Ajouter un D√©partement</h3>
                <div class="form-group"><label>Nom</label><input type="text" id="dept_name" class="input-field w-full md:w-1/2"></div>
                <button class="btn-primary mt-4" onclick="addDepartment()">Ajouter</button>
            </div>
            <div id="departments-list" class="list-container"></div>
        </div>

        <div id="semesters" class="section-view">
            <div class="header mb-6"><h1>Gestion des Semestres</h1></div>
            <div id="semesters-form" class="card" style="display:none;">
                <h3 class="text-lg font-bold mb-4">Ajouter Semestre</h3>
                <div class="form-grid grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="form-group"><label>Nom</label><input type="text" id="sem_name" class="input-field"></div>
                    <div class="form-group"><label>D√©but</label><input type="date" id="sem_start" class="input-field"></div>
                    <div class="form-group"><label>Fin</label><input type="date" id="sem_end" class="input-field"></div>
                </div>
                <button class="btn-primary mt-4" onclick="addSemester()">Ajouter</button>
            </div>
            <div id="semesters-list" class="list-container"></div>
        </div>

        <div id="salles" class="section-view">
            <div class="header mb-6"><h1>Gestion des Salles</h1></div>
            <div id="salles-form" class="card" style="display:none;">
                <h3 class="text-lg font-bold mb-4">Ajouter Salle</h3>
                <div class="form-grid grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="form-group"><label>Code</label><input type="text" id="salle_code" class="input-field"></div>
                    <div class="form-group"><label>Capacit√©</label><input type="number" id="salle_cap" class="input-field"></div>
                    <div class="form-group"><label>B√¢timent</label><input type="text" id="salle_build" class="input-field"></div>
                </div>
                <button class="btn-primary mt-4" onclick="addSalle()">Ajouter</button>
            </div>
            <div id="salles-list" class="list-container"></div>
        </div>

        <div id="sections" class="section-view">
            <div class="header mb-6"><h1>Gestion des Sections</h1></div>
            
            <div id="sections-form" class="card" style="display:none;">
                <h3 class="text-lg font-bold mb-4">Cr√©er une Section</h3>
                <div class="form-grid grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group"><label>Cours</label><select id="sec_course" class="input-field"></select></div>
                    <div class="form-group"><label>Professeur</label><select id="sec_prof" class="input-field"></select></div>
                    <div class="form-group"><label>Salle</label><select id="sec_salle" class="input-field"></select></div>
                    <div class="form-group"><label>Jour</label><select id="sec_day" class="input-field">
                        <option>Lundi</option><option>Mardi</option><option>Mercredi</option>
                        <option>Jeudi</option><option>Vendredi</option><option>Samedi</option>
                    </select></div>
                    <div class="form-group"><label>D√©but</label><input type="time" id="sec_start" class="input-field"></div>
                    <div class="form-group"><label>Fin</label><input type="time" id="sec_end" class="input-field"></div>
                    <div class="form-group"><label>Capacit√©</label><input type="number" id="sec_cap" value="30" class="input-field"></div>
                </div>
                <button class="btn-primary mt-4" onclick="addSection()">Cr√©er</button>
            </div>
            
            <div id="sections-list" class="list-container"></div>

            <div id="registrationManager" style="display:none;" class="mt-8"></div>
        </div>

        <div id="audit" class="section-view">
            <div class="header mb-6"><h1>Audit Logs</h1></div>
            <div class="card">
                <button class="btn-secondary mb-3" onclick="loadAudit()">Actualiser</button>
                <div id="audit-list" class="table-container"></div>
            </div>
        </div>
    </div>

    <script src="../static/js/dashboard_admin.js"></script>
</body>
</html>